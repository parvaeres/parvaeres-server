---
openapi: 3.0.0

info:
  title: Parvaeres API
  description: Parvaeres magic deployment API
  version: 0.0.1

servers:
  - url: http://api.alpha.parvaeres.io/v1
    description: Here we go, let's make this happen!

paths:

  /deployment:
    summary: Deployments
    description: This resource represents the deployments in the system
    post:
      summary: Create a new deployment
      requestBody:
        description: Repository and email address in an HTML form
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CreateDeploymentRequest'
      responses:
        '202':  # Accepted
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateDeploymentResponse'

  /deployment/{deploymentId}:
    summary: A deployment
    description: This resource represents an individual deployment
    get:
      summary: Get the deployment with id deploymentId
      parameters:
        - in: path
          name: deploymentId
          schema:
            type: string
          required: true
          description: the id of the deployment to retrieve
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentStatus'

components:
  schemas:
    CreateDeploymentRequest:
      type: object
      properties:
        Email:
          type: string
        Repository:
          type: string

    CreateDeploymentResponse:
      type: object
      properties:
        Message:
          type: string
        Error:
          type: boolean
        DeploymentStatus:
          type: object
          allOf:
            - $ref: '#/components/schemas/DeploymentStatus'

    DeploymentStatus:
      type: object
      properties:
        Status:
          type: string
          enum:
            - PENDING
            - SYNCING
            - DEPLOYED
            - ERROR
        LiveURLs:
          type: array
          items:
            type: string
